## 1.问题描述



使用Gin框架，解析配置文件，获取端口号，json数据等信息，可以在浏览器访问相应地址并返回正确的数据





## 2.技术背景



使用go语言，并且使用Gin框架实现，压测工具使用locust进行压测



## 3.解决方案



#### 1）导入”github.com/tietang/props/ini"包

​    

使用ini.NewIniFileConfigSource方法传入app.ini文件路径，并使用变量接收指针。

使用GetIntDefault方法，传入需要获取的端口号的字段名，以及默认值，使用变量接收 端口号。



#### 2）导入”github.com/spf13/pflag”包，使用pflag解析命令行参数传入的文件路径



设置接收变量，经过pflag处理输入的参数，传给接收的变量，获取文件路径。



#### 3）解析json文件



使用ioutil.ReadFile方法将路径传入，获取byte数组，将数组传入相应的结构体实例中，并且使用os.Create创建新的json文件，使用Encode方法，将数据写入新json文件。



#### 4）封装获取相应数据的方法



   <1> 输入稀有度，当前解锁阶段和cvc，获取该稀有度cvc合法且已解锁的所有士兵 

​       

   接收相应的参数，并且做特殊情况处理，如果解锁阶段为空字符串，单独判断解锁阶段为空字符串的士兵。其他情况，判断与传入参数相等，并且小于对应解锁. 阶段的合法士兵



   <2> 输入士兵id获取稀有度

​    

   接收参数，返回key为此参数的士兵的稀有度。



   <3> 输入士兵id获取战力

 

   接收参数，返回key为此参数的士兵的战力。



   <4> 输入cvc获取所有合法的士兵

 

   接收参数，返回cvc合法的所有士兵。



   <5> 获取每个阶段解锁相应士兵的json数据

  

​    创建key为解锁阶段，value为士兵结构体切片的map，将士兵添加到相应的解锁阶段下的切片中，如果切片还没初始化则先初始化。